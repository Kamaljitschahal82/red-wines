Red Wines Exploration by David del Río Medina
========================================================

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, width = 200,
                      echo=FALSE, warning=FALSE, message=FALSE)
```


```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

library(plyr)
library(gridExtra)
library(ggplot2)
library(GGally)
library(scales)
library(memisc)
```

```{r echo=FALSE, Load_the_Data}
# Load the Data
#setwd("E:/Dropbox/estudios/dataAnalyst/p4/p4_explore")
setwd("C:/Users/Administrador/Dropbox/estudios/dataAnalyst/p4/p4_explore")
reds <- read.csv('wineQualityReds.csv')
```

# Data Description Section
```{r}
names(reds)
```

The variable "X" is not mentioned in the text file describing the dataset. A quick look at the dataframe reveals that it is just a unique id for every observation. It may be useful later, so we can keep it but change the name in order to avoid confusion.

```{r}
reds <- plyr::rename(reds, c("X"="id"))
str(reds)
```

The variable quality has a very limited number of values. We can convert it to a factor:

```{r}
reds$quality <- factor(reds$quality)
```


It looks like all free.sulfur.dioxide and total.sulfur.dioxide values are whole numbers. It turns out this is true except for a few cases within each variable, all of them having exactly half a unit more:

```{r}
with(reds, subset(free.sulfur.dioxide, free.sulfur.dioxide %% 1 != 0))
with(reds, subset(total.sulfur.dioxide, total.sulfur.dioxide %% 1 != 0))
```

My guess is that this is due to these two variables being measured in (mg / dm^3), while the rest are in (g / dm^3). I suppose that more precision is not needed and/or impossible to measure with the available resources.

```{r}
summary(reds)
```

There are some variables with possible outliers: volatile.acidity, citric.acid, residual.sugar, chlorides, free and total.sulfur.dioxide and sulphates have maximum values that are far away from the third quartile.

# Univariate Plots Section
```{r echo=FALSE, Univariate_Plots}
ggplot(data = reds, aes(x = fixed.acidity)) +
  geom_histogram(binwidth = 0.5) +
  scale_x_continuous(breaks = seq(4, 16, 1), limits = c(4, 16))
```

```{r}
ggplot(data = reds, aes(x = volatile.acidity)) +
  geom_histogram(binwidth = 0.05) +
  scale_x_continuous(breaks = seq(0, 2, 0.1), limits = c(0, 2))
```

The variables fixed.acidity and volatile.acidity look normally distributed.


```{r}
c1 <- ggplot(data = reds, aes(x = citric.acid)) +
  geom_histogram(binwidth = 0.05) +
  scale_x_continuous(breaks = seq(0, 1.2, 0.1), limits = c(0, 1.2))

c2 <- ggplot(data = reds, aes(x = citric.acid)) +
  geom_histogram(binwidth = 0.05) +
  scale_x_log10(breaks = seq(0, 1.2, 0.1))

grid.arrange(c1, c2, ncol=1)
```

The variable citric.acid is very skewed to the right. The log transform shows a peak between 0.4 and 0.6.


```{r}
r1 <- ggplot(data = reds, aes(x = residual.sugar)) +
  geom_histogram(binwidth = 0.1)

r2 <- ggplot(data = reds, aes(x = residual.sugar)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_continuous(breaks = seq(0, 3.5, 0.5), limits = c(0, 3.5))

grid.arrange(r1, r2, ncol=1)
```

```{r}
ch1 <- ggplot(data = reds, aes(x = chlorides)) +
  geom_histogram(binwidth = 0.005)

ch2 <- ggplot(data = reds, aes(x = chlorides)) +
  geom_histogram(binwidth = 0.005) +
  scale_x_continuous(breaks = seq(0, 0.15, 0.05), limits = c(0, 0.15))

grid.arrange(ch1, ch2, ncol=1)
```

The variables residual.sugar and chlorides look normally distributed, but both have very distant outliers. 

```{r}
fsd1 <- ggplot(data = reds, aes(x = free.sulfur.dioxide)) +
  geom_histogram(binwidth = 1) +
  scale_x_continuous(breaks = seq(0, 80, 5))

fsd2 <- ggplot(data = reds, aes(x = free.sulfur.dioxide)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_log10(breaks = seq(0, 80, 10))

grid.arrange(fsd1, fsd2, ncol=1)
```

```{r}
tsd1 <- ggplot(data = reds, aes(x = total.sulfur.dioxide)) +
  geom_histogram(binwidth = 5) +
  scale_x_continuous(breaks = seq(0, 290, 10))

tsd2 <- ggplot(data = reds, aes(x = total.sulfur.dioxide)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_log10(breaks = seq(0, 290, 25))

grid.arrange(tsd1, tsd2, ncol=1)
```

Both free.sulfur.dioxide and total.sulfur.dioxide are skewed to the right. The last has very distant outliers. They look normally distributed when a log-transform is applied.

```{r}
ggplot(data = reds, aes(x = density)) +
  geom_histogram(binwidth = 0.0005)
```

```{r}
ggplot(data = reds, aes(x = pH)) +
  geom_histogram(binwidth = 0.05)
```

Both density and pH look normally distributed.

```{r}
ggplot(data = reds, aes(x = sulphates)) +
  geom_histogram(binwidth = 0.05)
```

The variable sulphates look normally distributed, with some outliers.

```{r}
a1 <- ggplot(data = reds, aes(x = alcohol)) +
  geom_histogram(binwidth = 0.1)

a2 <- ggplot(data = reds, aes(x = alcohol)) +
  geom_histogram(binwidth = 0.01) +
  scale_x_log10()

grid.arrange(a1, a2, ncol=1)
```

The variable alcohol is skewed to the right. Applying a log-transform does not change much.

```{r}
ggplot(data = reds, aes(x = quality)) +
  geom_bar() +
  scale_x_discrete(breaks = seq(0, 10, 1))
```

An overwhelming majority of wines, about 1300 of the total 1599, are rated 5 or 6, and about 200 are rated 7. The rest are rated 3, 4 or 8.

# Univariate Analysis

### What is the structure of your dataset?

There are 1599 red wines in the dataset with 12 features and an identifier number. Except quality, which is discrete, the rest of the features are continuous, althogh most of the values of free.sulfur.dioxide and total.sulfur.dioxide are whole.

### What is/are the main feature(s) of interest in your dataset?

The main feature is quality. I would like to know if and which ones of the other features can help determine the quality of a red wine.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

The info provided by the authors of the dataset gives a few tips about which variables can affect the quality of the wine (volatile acidity, the combination of free and total sulfur dioxide, sulphates...) but it is far from comprehensive.

Given that most wines are rated of medium quality (5 or 6 in a scale of 0 to 10), and the fact that there are several variables with very distant outliers, points me to think that very small or very large values of certain variables are fundamental in the creation of non-average wines.

### Did you create any new variables from existing variables in the dataset?

No. At this point, I cannot think of any useful transformation or combination of the current variables that results in a new one.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

There were some right-skewed distributions. I applied a log-transform to get better insights about the distributions.

Several variables had large outliers. I created a cropped version of some of them to have more details of the bulk of the data.



# Bivariate Plots Section

```{r echo=FALSE, Bivariate_Plots}
ggpairs(subset(reds, select = -id), 
  lower = list(continuous = wrap("points", shape = I('.'))), 
  upper = list(combo = wrap("box", outlier.shape = I('.'))))
```

The boxplots in the matrix show correlations between quality and other variables: volatile.acidity, citric.acid, sulphates and alcohol. The variables density and pH might be related too, but this could be because these variables are correlated with others: pH with citric.acid and density with alcohol and citric.acid.

We are going to look closer into all this.

```{r}
ggplot(data = reds, aes(y = volatile.acidity, x = quality)) +
  geom_boxplot()
```

```{r}
v1 <- ggplot(data = reds, aes(volatile.acidity, colour = quality)) +
  geom_freqpoly(binwidth = 0.05)
v2 <- ggplot(data = reds, aes(volatile.acidity, fill = quality)) +
  geom_histogram(binwidth = 0.05)

grid.arrange(v1, v2, ncol=1)
```


It looks like as volatile acidity increases, quality decreases, although there are two observations worth mentioning:
- Wines with a quality score of 7 and 8 (the best of the dataset) have similar median volatile acidity. However, the volatile acidity of wines with a quality of 7 is more dispersed.
- Outliers with a quality of 7 and 8 have a volatile acidity similar to the median of the worst rated wines (score of 3): volatile acidity alone cannot explain the differences in quality.

These findings agree with the information provided by the authors of the dataset: "too high levels can lead to an unpleasant, vinegar taste".

```{r}
ggplot(data = reds, aes(y = citric.acid, x = quality)) +
  geom_boxplot()
```

```{r}
c1 <- ggplot(data = reds, aes(citric.acid, colour = quality)) +
  geom_freqpoly(binwidth = 0.05)
c2 <- ggplot(data = reds, aes(citric.acid, fill = quality)) +
  geom_histogram(binwidth = 0.05)

grid.arrange(c1, c2, ncol=1)
```

The variables quality and citric.acid are positively correlated. However, wines with a quality score of 7 or 8 present very similar levels of citric acid. For the rest, the amount of citric acid is very dispersed, although the median citric acid quantity for low quality wines is very low.

```{r}
ggplot(data = reds, aes(y = alcohol, x = quality)) +
  geom_boxplot()
```

```{r}
a1 <- ggplot(data = reds, aes(alcohol, colour = quality)) +
  geom_freqpoly(binwidth = 0.1)
a2 <- ggplot(data = reds, aes(alcohol, fill = quality)) +
  geom_histogram(binwidth = 0.1)

grid.arrange(a1, a2, ncol=1)
```

It looks like the higher the amount of alcohol content in a wine, the better the score it receives, but this effect only appears in wines with a quality of 6 or more, having the rest similar median values. There are a lot of outliers with a high percent of alcohol between the wines of quality 5.


```{r}
ggplot(data = reds, aes(y = sulphates, x = quality)) +
  geom_boxplot()
```

```{r}
s1 <- ggplot(data = reds, aes(sulphates, colour = quality)) +
  geom_freqpoly(binwidth = 0.05)
s2 <- ggplot(data = reds, aes(sulphates, fill = quality)) +
  geom_histogram(binwidth = 0.05)

grid.arrange(s1, s2, ncol=1)
```

The amount of sulphates is slightly positively correlated with the quality of the wine, but the effect is not as pronounced as with the other variables mentioned above. There are a lot of outliers.

```{r}
ggplot(data = reds, aes(y = density, x = quality)) +
  geom_boxplot()
```

It seems to exist a mild negative correlation between density and quality. I doubt the experts can detect such small variations in density between different wines, or even care about it. My guess is that this is due to density being correlated with other influential variables, like alcohol, or just pure randomness.

```{r}
ggplot(data = reds, aes(y = pH, x = quality)) +
  geom_boxplot()
```

This is similar to the last case. Can we detect with our sense of taste differences in pH of one unit maximum?. Maybe this is cause by the existing negative correlation between pH and citric.acid.

There are correlations of moderate strength (~ 0.5) (REFERENCIA AQUÍ) between some of these variables. It might be interesting to have a closer look:

```{r}
ggplot(data = reds, aes(y = volatile.acidity, x = citric.acid)) +
  geom_point()
```

```{r}
ggplot(data = reds, aes(y = pH, x = citric.acid)) +
  geom_point()
```

Both volatile.acidity and pH are negatively correlated with citric.acid. The latter makes sense: low pH values indicate acidity.

The relation between acetic acid (volatile.acidity) and citric acid is not that clear. Acordding to Wikipedia (REFERENCIA AQUÍ): "When citric acid is added, it is always done after primary alcohol fermentation has been completed due to the tendency of yeast to convert citric into acetic acid." Maybe low levels of citric acid are a sign that it was added prematurely.

```{r}
ggplot(data = reds, aes(y = density, x = alcohol)) +
  geom_point()
```

High levels of alcohol are asociated with low density, which makes sense, since alcohol is less dense than water: the main component of wine. (REFERENCIA AQUÍ)

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

The data suggests that alcohol, citric.acid and volatile.acidity are the most decisive features for the quality of a wine, having the first two a positive correlation with quality and the latter a negative one. However, a far from negligible number of wines of any quality can be found along (almost) the whole spectrum of these features: none of them alone nor combined can fully explain quality, not even close.

Another three features are weakly (~ +-0.2) correlated with quality: sulphates, density and pH.

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

Citric.acid is negatively correlated with both volatile.acidity and pH (~ -0.5). Alcohol is inversely correlated with density (~ 0.5). This may explain why density and pH, that are (I presume) hard to detect without tools are correlated with quality, even if weakly.

### What was the strongest relationship you found?

It is not easy to say between the three that are mentioned above. The overall strength of the relationships between quality and alcohol, citric.acid and volatile.acidity is similar. However, these relationships are not exactly linear:

- Wines of the highest qualities (7 and 8) share similar levels of acetic acid (volatile.acidity). Maybe low quantities of acetic acid (below approximately 0.4 g /dm^3) do not influence quality.

- In a similar fashion, the upward trend of citric.acid with respect to quality seem to flatten at approximately 0.4 g/dm^3. 

- The median quantity of alcohol in the lowest quality wines (3, 4 and 5) is similar. There is an upward trend after that.

# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}
p1 <- ggplot(data = reds, aes(y = citric.acid, x = alcohol, colour=quality)) +
  geom_point(size=3)

p2 <- ggplot(data = reds, aes(y = volatile.acidity, x = alcohol, colour=quality)) +
  geom_point(size=3)

p3 <- ggplot(data = reds, aes(y = volatile.acidity, x = citric.acid, colour=quality)) +
  geom_point(size=3)

grid.arrange(p1, p2, p3, ncol=1)
```

Scatter plots of the main variables, colored by quality. We can see the linear correlation between volatile.acidity and linear.acid, mention aboved, and also that there is no linear correlation between alcohol and citric.acid. Unfortunately, there are so many wines of quality 5 and 6 that it is hard to grasp more detailed information. We are going to examine these same plots, but removing these wines:

```{r echo=FALSE}
df.extreme.quality <- subset(reds, quality != 6 & quality != 5)
ggplot(data = df.extreme.quality, aes(y = citric.acid, x = alcohol, colour=quality)) +
  geom_point(size=3)
```

High quality wines tend to concentrate in the upper-right part of the plot. The opposite happens with bad quality ones. As suggested before, high values of alcohol and citric.acid are influential in the quality of the wine.

```{r echo=FALSE}
ggplot(data = df.extreme.quality, aes(y = volatile.acidity, x = alcohol, colour=quality)) +
  geom_point(size=3)
```

The plot shows that bad quality wines tend to have more than 0.6 g / dm^3 of acetic acid, while the bulk of high quality wines are below this point. 

```{r echo=FALSE}
ggplot(data = df.extreme.quality, aes(y = volatile.acidity, x = citric.acid, colour=quality)) +
  geom_point(size=3)
```

As expected, the plot shows that high volatile.acidity and low citric.acid is usually an indicator of bad quality.

We can visualize all these features together in the same plot:

```{r}
ggplot(data = df.extreme.quality, aes(y = citric.acid, x = alcohol, colour=quality, size=volatile.acidity)) +
  geom_point()
```

It seems the plot confirms everything suggested by the rest of the analyisis: bad quality wines tend to have high values of volatile.acidity and low values of alcohol and citric.acid.



# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

The three most influential features (alcohol, citric.acid and volatile.acidity) strength each other: the bulk of high quality wines are in the medium-high range in alcohol and citric.acid quantity, and their volatile.acidity is in the medium-low range. The ones with the highest quality (eight) tend to concentrate even more on the extremes. The opposite situation happens with bad quality wines.

### Were there any interesting or surprising interactions between features?

It looks like very high volatile.acidity values almost completely prevent a wine to achieve a high quality rating. There are some high rated wines with very low citric acid and alcohol content, and even with a slightly high volatile acidity (~0.8), but higher than that there is almost none. 

It is like there is a threshold at approximately 0.8-0.9 g/dm^3 of acetic acid from which the unpleasant vinegar taste, described by the authors of the dataset, is noted.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}
ggplot(data = reds, aes(x = quality, fill = quality)) +
  geom_bar() +
  scale_y_continuous(breaks = seq(0, 700, 100)) +
  scale_x_discrete(breaks = seq(0, 10, 1)) +
  guides(fill = FALSE) +
  ggtitle('Quality histogram') +
  xlab('Quality') + 
  ylab('Number of wines')
```


### Description One

A very big majority of wines are of quality five or six. There are very few of quality three or eight, and no wine achieves a more extreme quality rating: of a scale of zero to ten, there are no wines with a quality rating of zero, one, two, nine or ten.

This is probably due to the way the wines are rated. According to the information provided by the authors: "the output is based on sensory data (median of at least 3 evaluations made by wine experts)". Unfortunately, we do not have the individual evaluations for each wine, so we cannot know how dispersed are these.

### Plot Two
```{r echo=FALSE, Plot_Two}
v1 <- ggplot(data = reds, aes(y = volatile.acidity, x = quality, fill = quality)) +
  geom_boxplot() +
  guides(fill = FALSE) +
  ggtitle('Volatile acidity by quality') +
  xlab('Quality') + 
  ylab('Acetic acid content (g/dm^3)')

v2 <- ggplot(data = reds, aes(volatile.acidity, colour = quality)) +
  geom_freqpoly(binwidth = 0.05, size = 1) +
  guides(colour = FALSE) +
  xlab('Acetic acid content (g/dm^3)') + 
  ylab('Number of wines')

v3 <- ggplot(data = reds, aes(volatile.acidity, fill = quality)) +
  geom_histogram(binwidth = 0.05) +
  guides(fill = FALSE) +
  xlab('Acetic acid content (g/dm^3)') + 
  ylab('Number of wines')

c1 <- ggplot(data = reds, aes(y = citric.acid, x = quality, fill = quality)) +
  geom_boxplot() +
  guides(fill = FALSE) +
  ggtitle('Citric acid by quality') +
  xlab('Quality') + 
  ylab('Citric acid content (g/dm^3)')

c2 <- ggplot(data = reds, aes(citric.acid, colour = quality)) +
  geom_freqpoly(binwidth = 0.05, size = 1) +
  guides(colour = FALSE) +
  xlab('Citric acid content (g/dm^3)') +
  ylab('')

c3 <- ggplot(data = reds, aes(citric.acid, fill = quality)) +
  geom_histogram(binwidth = 0.05) +
  guides(fill = FALSE) +
  xlab('Citric acid content (g/dm^3)') +
  ylab('')


a1 <- ggplot(data = reds, aes(y = alcohol, x = quality, fill = quality)) +
  geom_boxplot() +
  guides(fill = FALSE) +
  ggtitle('Alcohol by quality') +
  xlab('Quality') + 
  ylab('Alcohol content (% by volume)')


a2 <- ggplot(data = reds, aes(alcohol, colour = quality)) +
  geom_freqpoly(binwidth = 0.1, size = 1) +
  xlab('Alcohol content (% by volume)') +
  ylab('')

a3 <- ggplot(data = reds, aes(alcohol, fill = quality)) +
  geom_histogram(binwidth = 0.1) +
  xlab('Alcohol content (% by volume)') +
  ylab('')

grid.arrange(v1, c1, a1, v2, c2, a2, v3, c3, a3, ncol=3)
```

### Description Two

Boxplots, frequency polygons and histograms of what the data suggest are the three most influential features, colored by each one of the six quality ratings. All these features have a moderate correlation with quality, but are not linear: they seem to flatten for the highest quality wines (volatile acidity, citric acid) or the lowest (alcohol).

The plots show that the bulk of the high quality wines tend to favor low volatile acidity and high citric acid and alcohol, while the opposite happens with low quality wines. However, the difference in the number of wines per quality rating makes it somewhat difficult to visualize these trends.

### Plot Three
```{r echo=FALSE, Plot_Three}
ggplot(data = df.extreme.quality, aes(y = citric.acid, x = alcohol, colour=quality, size=volatile.acidity)) +
  geom_point() +
  ggtitle('The three most influential features versus quality in extreme quality wines') +
  xlab('Alcohol content (% by volume)') +
  ylab('Citric acid content (g/dm^3)') +
  scale_size_continuous(name='acetic acid (g/dm^3)')
```

### Description Three

Quality and the three most influential variables visualized together in one plot. Wines of quality five or six are not displayed in order to avoid excessive clutter.

The trends identified during the analysis are clearly shown here. The plot also shows that no combination of these three features can fully explain quality, which is expected, being the quality of a wine a rather subjective feature.

It is also worth mentioning that the plot suggests that very high values of acetic acid (volatile acidity) almost always prevents a wine from achieven a high quality rating: there are a few highly rated wines with very low alcohol and citric acid content, but none with very high volatile acidity.

------

# Reflection

The red wines dataset contains almost 1600 observations and 12 features, plus one identifier variable. Eleven of these features are objective measurements (e.g. pH, alcohol content...) and the last one is a subjective quality rating calculated by taking the median of the scores assigned by three or more experts, in a scale of zero to ten.

The subjective nature of quality and the way it is calculated present the major challenges when analysing the data. 

Its subjective nature makes it difficult to find a definitive answer to what determines the quality of a wine. In fact, there is not a single strong correlation between quality and other features, although some of them seem to be more influential than others. However, the data exploration performed suggests there is no combination of features that can accurately predict quality. This is supported by the study (REFERENCIA AQUI) performed by the authors of the dataset: none of the models could predict the exact quality rating for about 35-40 percent of the wines.

The way this quality rating is calculated (median of subjective evaluations) probably explains why most of the wines are of quality five or six. This makes visual analyses troublesome, since most observations just add clutter and it is hard to identify trends from them. Furthermore, the scarcity of wines of extreme quality it is an invitation to be very cautious about the conclusions extracted from their analysis, since the sample may be too small. 

Despite these complications, some trends and three influential features were identified. The plots provided show that the bulk of low and high quality wines can be separated based on these features.